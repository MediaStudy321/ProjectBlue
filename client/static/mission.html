<html>

<head>
	<title>Choose your Mission</title>
	<!-- This if used for displaying profile in mission-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link rel=stylesheet type=text/css href="stylesheet.css">
</head>

<body>
	<style>
		body {
			background-color: goldenrod;
			font-family: 'Times New Roman', Times, serif;
		}
		#boxloc {
			background-color: white;
			position: absolute;
			border: 5px solid black;
			right: 0%;
			top: 0%;
			bottom: 0%;
		}

		#shift {
			position: relative;
			left: 3%;
		}

		/*style*/
		.tab {
			overflow: hidden;
			border: 1px solid gray;
			background-color: white;
		}

		.tab button {
			background-color: inherit;
			float: left;
			border: 1px solid gray;
			outline: none;
			cursor: pointer;
			padding: 14px 16px;
			transition: 0.5s;
			font-size: 12;
		}

		.tab button:hover {
			background-color: gray;
		}

		.tab button.active {
			background-color: red;
		}

		.tabcontent {
			display: none;
			padding: 6px 12px;
			border: 1px solid grey;
			border-top: none;
		}

		.hidden {
			display: none;
		}

		.show {
			display: inline;
		}
	</style>

	<div id="mainpanel">
		Welcome to Town! Stock up on supplies at the store or Vote on a mission to start with your party!

		<ol>
			<li><button><a href="store.html">Store</a></button></li>
			<li><button id="forest">Forest</button></li>
			<li><button id="cave">Caves</button></li>
			<li><button id="mountain">Mountain</button></li>

		</ol>
	</div>
	<div id="boxloc">
		<div id="shift">
			<h1 id="charname"></h1>
			<h3> Class: <a id="class"></a></h3>
			<h3> Lv: <a id="lv"></a></h3>
			<h5> Exp: <a id="exp"></a></h5>
		</div>

		<div class="tab">
			<button class="tablinks" onclick="openProfile(event, 'Stats')">Stats</button>
			<button class="tablinks" onclick="openProfile(event, 'Skills & Talents')">Skills & Talents</button>
			<button class="tablinks" onclick="openProfile(event, 'Equipment')">Equipment</button>
			<button class="tablinks" onclick="openProfile(event, 'Inventory')">Inventory</button>
			<button class="tablinks" onclick="openProfile(event, 'Quest')">Quest</button>
		</div>

		<div id="Stats" class="tabcontent">
			<p>Health: <span id="hp">0</span> <button id="roll_hp" class="rollbutton">Roll For Stats</button></p>
			<p>Mana: <span id="mp">0</span> <button id="roll_mp" class="rollbutton">Roll For Stats</button></p>
			<p>Phy.Attack: <span id="pa">0</span> <button id="roll_pa" class="rollbutton">Roll For Stats</button></p>
			<p>Phy.Defense: <span id="pd">0</span> <button id="roll_pd" class="rollbutton">Roll For Stats</button></p>
			<p>Mag.Attack: <span id="ma">0</span> <button id="roll_ma" class="rollbutton">Roll For Stats</button></p>
			<p>Mag.Defense: <span id="md">0</span> <button id="roll_md" class="rollbutton">Roll For Stats</button></p>
			<p>Dexterity: <span id="d">0</span> <button id="roll_dex" class="rollbutton">Roll For Stats</button></p>
			<br/>
			<p id="statsrolls"></p>
			<button id="freeexp">free lv up</button>
		</div>

		<div id="Skills & Talents" class="tabcontent">
			<h5><a>Skills</a></h5>
			<br />
			<div id="skills"></div>
		</div>

		<div id="Equipment" class="tabcontent">
			<p>Weapon: <a id="weapon"></a></p>
			<p>Head: <a id="head"></a></p>
			<p>Armor: <a id="armor"></a></p>
			<p>Gloves: <a id="gloves"></a></p>
			<p>Pants: <a id="pants"></a></p>
			<p>Shoes: <a id="shoes"></a></p>
		</div>

		<div id="Inventory" class="tabcontent">
			<p>10 Gold Coins</p>
			<p>Beaten Up Backpack</p>
			<p>Small Canteen</p>
		</div>

		<div id="Quest" class="tabcontent">
			<p>Your party has tracked down Lord Superius to his underground lair, but a magic forcefield blocks its
				entrance. You must find a way to bring down the forcefield in order to retrieve the Eternal Stone.</p>
		</div>
	</div>


	<script src="battle/skills.js"></script>
	<script src="battle/gamestats.js"></script>

	<script>
		function openProfile(evt, profileTab) {
			var i, tabcontent, tablinks;
			tabcontent = document.getElementsByClassName("tabcontent");
			for (i = 0; i < tabcontent.length; i++) {
				tabcontent[i].style.display = "none";
			}
			tablinks = document.getElementsByClassName("tablinks");
			for (i = 0; i < tablinks.length; i++) {
				tablinks[i].className = tablinks[i].className.replace(" active", "");
			}
			document.getElementById(profileTab).style.display = "block";
			evt.currentTarget.className += " active";
		}

		document.getElementById("forest").onclick = function () {
			sessionStorage.setItem("map", "forest")
			window.location = "battle2.html"
		}
		document.getElementById("cave").onclick = function () {
			sessionStorage.setItem("map", "cave")
			window.location = "battle2.html"
		}
		document.getElementById("mountain").onclick = function () {
			sessionStorage.setItem("map", "mountain")
			window.location = "battle2.html"
		}


		$(() => {
			var character = {
				stats: {}
			};
			$('#content').load("profile.html");

			const load = async () => {
				try {
					await $.ajax({
						url: '/getcharacter',
						type: 'GET',
						success: (data) => {
							character = data;
							updateProfile();
							console.log(character);
						}
					});
				}
				catch (e) { console.log(e) }
			}

			var updateProfile = () => {
				$('#exp').html(character.exp);
				// Stats tab
				$('#charname').html(character.name);
				$('#hp').html(character.stats.max_hp);
				$('#mp').html(character.stats.max_mp);
				$('#pa').html(character.stats.physical_atk);
				$('#pd').html(character.stats.physical_def);
				$('#ma').html(character.stats.magical_atk);
				$('#md').html(character.stats.magical_def);
				$('#d').html(character.stats.dex);
				if(character.exp>0) {
					$('.rollbutton').show();
				}
				else {
					$('.rollbutton').hide();
				}
			}

			load();

			function statdice() {
				var dice = [1, 2, 3];
				var roll = dice[Math.floor(Math.random() * dice.length)];
				return roll;
			}

			const updateCharacter = () => {
				$.ajax({
					type: 'POST',
					url: 'characterupdates',
					data: character,
					success: (data) => {
						if(data=='SUCCESS') updateProfile();
						else location.reload();
					}
				});
			}
			
			const increase = (stat)=> {
				if(character.exp>0) {
					let increase = statdice();
					if(stat=='max_hp') increase++;
					character.stats[stat]+=increase;
					character.exp--;
					updateCharacter();
				}
				else updateProfile();
			}

			$('#roll_hp').click(()=>{increase('max_hp')});
			$('#roll_mp').click(()=>{increase('max_mp');});
			$('#roll_pa').click(()=>{increase('physical_atk');});
			$('#roll_pd').click(()=>{increase('physical_def');});
			$('#roll_ma').click(()=>{increase('magical_atk');});
			$('#roll_md').click(()=>{increase('magical_def');});
			$('#roll_dex').click(()=>{increase('dex');});
			/*tab functions*/
			////////

			var EQweapon = "Hands";

			function loadEquipments() {
				if (sessionStorage.getItem("Weapon") == null || sessionStorage.getItem("Weapon") == "") {
					sessionStorage.setItem("Weapon", EQweapon);
				}
				else {
					EQweapon = (sessionStorage.getItem("Weapon"));
				}
				document.getElementById("weapon").innerHTML = EQweapon;
			}

			///// skills

			function loadskills() {
				var characterskills = [];
				if (characterclass == "Mage") {
					characterskills = mageskills;
				}
				else if (characterclass == "Warrior") {
					characterskills = warskills;
				}
				else if (characterclass == "Rouge") {
					characterskills = rouskills;
				}
				else if (characterclass == "Bard") {

				}
			}



			///
			/*dev Corner*/
			$('#freeexp').on('click', (event)=>{
				character.exp+=2;
				updateProfile();
			});

		});
	</script>

</body>

</html>